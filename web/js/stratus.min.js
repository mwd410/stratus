/*! stratus-dev v0.1.0 : 2013-09-19 */
"use strict";var app=angular.module("App",["ngAnimate"]);app.controller("MenuController",function($scope){var path=window.location.pathname,pathMenus={"/":[],"/accounts|/dashboard":[{url:"/accounts",name:"Accounts"},{url:"/dashboard",name:"Dashboard"}]};$scope.currentPath=path,$scope.menuOptions=[];for(var key in pathMenus){var paths=key.split("|");-1!=paths.indexOf(path)&&($scope.menuOptions=pathMenus[key])}}),app.filter("obstructed",function(){return function(input,size){return"undefined"==typeof size&&(size=4),input.slice(0,size)+"************"+input.slice(-size)}}),String.prototype.repeat=function(length){return new Array(length+1).join(this)};var Utils={apply:function(obj,vals){for(var key in vals)obj[key]=vals[key];return obj},applyIf:function(obj,vals){for(var key in vals)key in obj||(obj[key]=vals[key])},isArray:"isArray"in Array?Array.isArray:function(value){return"[object Array]"===Object.prototype.toString.call(value)},each:function(array,fn,scope){if(Utils.isArray(array)){for(var i=0,len=array.length;len>i;++i)if(!1===fn.call(scope||array[i],array[i],i,len))return i}else fn.call(scope||array,array,0,1);return!0},eachKey:function(object,fn,scope){for(var key in object)fn.call(scope||object[key],object[key],key)},pluck:function(array,property){var plucked=[];return Utils.each(array,function(item){plucked.push(item[property])}),plucked}};app.controller("AccountManagementController",function($scope,$http){$scope.accounts=[],$scope.newAccountId="",$http.get("/getAccounts").success(function(response){$scope.accounts=response.accounts,$scope.masterAccount=response.masterAccount,$scope.commitMaster()}),$scope.commitMaster=function(){$scope.originalMasterAccount=angular.copy($scope.masterAccount)},$scope.add=function(){$scope.accounts.unshift({id:$scope.newAccountId,name:"",aws_key:"",secret_key:""})}}),app.controller("AccountController",function($scope,$http){function save(){angular.copy($scope.account,master),$scope.commitMaster()}function commitNew(){$http.post("/account/add",{account:$scope.account,master:$scope.masterAccount}).success(function(result){result.success===!0&&(isNew=!1,save())})}function commitModified(){$http.post("/account/edit",{account:$scope.account,master:$scope.masterAccount}).success(function(result){result.success===!0&&(isModified=!1,save())})}function commitPendingDelete(){$http.post("/account/delete",{id:$scope.account.id}).success(function(result){result.success===!0&&$scope.accounts.splice($scope.account,1)})}$scope.fv={aws_key:{length:20},secret_key:{length:40}};var master=angular.copy($scope.account),isNew=$scope.account.id==$scope.newAccountId,isModified=!1,isPendingDelete=!1;$scope.isAdding=function(){return isNew},$scope.isEditing=function(){return isModified},$scope.isDeleting=function(){return isPendingDelete},$scope.isModifying=function(){return $scope.isAdding()||$scope.isEditing()||$scope.isDeleting()},$scope.edit=function(){isModified=!0},$scope.delete=function(){isPendingDelete=!0},$scope.commit=function(){isNew?commitNew():isModified?commitModified():isPendingDelete&&commitPendingDelete()},$scope.cancel=function(){isNew?$scope.accounts.splice($scope.account,1):angular.copy(master,$scope.account),isNew=!1,isModified=!1,isPendingDelete=!1}}),app.controller("AnalysisPageController",function($scope){$scope.path=window.location.pathname;var id,pathSuffix="";(id=$scope.path.split("/").pop().match(/^\d+$/))&&(pathSuffix="/"+id),$scope.pages=[{path:"/analysis/overview"+pathSuffix,title:"Overview"},{path:"/analysis/totals"+pathSuffix,title:"Totals"},{path:"/analysis/instances"+pathSuffix,title:"Instances"},{path:"/analysis/volumes"+pathSuffix,title:"Volumes"}]}),app.controller("AnalysisOverviewController",function($scope){$scope.sort={property:"name",reverse:!1},$scope.sortBy=function(property){$scope.sort.reverse=!$scope.sort.reverse,$scope.sort.property=property},$scope.accounts=overviewGridData}),app.controller("RegisterController",function($scope,$http){$scope.emailAvailable=!0,$scope.validateRegistration=function(){$scope.registerForm.email.$valid&&$http.post("/isEmailAvailable",{email:$scope.email}).success(function(result){$scope.emailAvailable=result.available})}}),function(ng){ng.module("App").controller("DashboardController",function($scope){$scope.dashboard={widgetRows:[{height:400,widgetColumns:[{flex:1,widgets:[{flex:1,tpl:"/js/directives/tpl/total-cost.html"}]}]}]}})}(window.angular),app.directive("ddOverviewTd",function(){return{scope:{value:"@ddOverviewTd"},restrict:"A",template:'<div data-ng-show="true"></div>{{value}}%',controller:function($scope,$element){var cls,iconCls;$scope.value>0?(cls="gain",iconCls="icon-arrow-up"):$scope.value<0?(cls="loss",iconCls="icon-arrow-down"):(cls="neutral",iconCls=!1),$element.addClass(cls),iconCls&&$element.find("> div:first-child").addClass(iconCls)},link:function(scope){console.log(scope)}}}),app.directive("ddOverviewTh",function(){return{restrict:"A",require:"ddOverviewTh",controller:function($scope){this.sortBy=function(property){$scope.sortBy(property)}},link:function(scope,element,attrs){scope.$watch(attrs.ddOverviewTh)}}}),app.directive("ddSortTable",function(){return{require:"ddSortTable",controller:function($scope){this.sortBy=function(property){$scope.sortBy(property)}},link:function(scope,element,attrs,controller){element.find("th").each(function(){$(this).click(function(){controller.sortBy($(this).attr("sort-property"))})})}}}),function(ng){ng.module("App").directive("stDash",function(){return{require:"stDash",scope:{dash:"=stDash"},controller:function(){},replace:!0,templateUrl:"/js/directives/tpl/stDash.html",link:function(){}}})}(window.angular),function(ng){ng.module("App").directive("stWidgetRow",function(){return{require:["stWidgetRow","^stDash"],scope:{widgetRow:"=stWidgetRow"},controller:function(){var totalFlex;this.init=function(row){totalFlex=Utils.pluck(row.widgetColumns,"flex").reduce(function(prev,curr){return parseInt(prev,10)+parseInt(curr,10)}),Utils.each(row.widgetColumns,function(column){column.width=100*column.flex/totalFlex},this)}},replace:!0,templateUrl:"/js/directives/tpl/stWidgetRow.html",link:function(scope,el,attrs,controllers){var rowController=controllers[0];controllers[1],rowController.init(scope.widgetRow)}}})}(window.angular),function(ng){ng.module("App").directive("stWidgetColumn",function(){return{require:["stWidgetColumn","^stWidgetRow"],controller:function(){var totalFlex;this.init=function(column){totalFlex=Utils.pluck(column.widgets,"flex").reduce(function(prev,curr){return parseInt(prev,10)+parseInt(curr,10)}),Utils.each(column.widgets,function(widget){widget.height=100*widget.flex/totalFlex},this)}},templateUrl:"/js/directives/tpl/stWidgetColumn.html",replace:!0,scope:{widgetColumn:"=stWidgetColumn",index:"="},link:function(scope,el,attrs,controllers){var columnController=controllers[0];controllers[1],columnController.init(scope.widgetColumn)}}})}(window.angular),function(ng){ng.module("App").directive("stWidget",function(){return{templateUrl:"/js/directives/tpl/stWidget.html",replace:!0,require:["stWidget","^stWidgetColumn","^stDash"],scope:{widget:"=stWidget",index:"="},controller:function(){},link:function(scope,el,attrs,controllers){controllers[0],controllers[1],el.css("padding")}}})}(window.angular);