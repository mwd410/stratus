<div class="st-alert-wrapper">

    <div class="st-alert"
         data-ng-repeat="alert in alerts"
         data-ng-controller="AlertCtrl">

        <header>
            adsf{{ name + '&nbsp;' }}
            <div class="icons">
                <span data-ng-show="!confirmDelete && !isEditing">
                    <button class="st-button"
                            data-ng-click="isEditing = !isEditing">
                        <i class="icon-pencil icon-large"></i>
                    </button>
                    <button class="st-button"
                            data-ng-click="confirmDelete = !confirmDelete">
                        <i class="icon-trash icon-large"></i>
                    </button>
                </span>
                <span data-ng-show="confirmDelete">
                    Are you sure you want to delete this alert?
                    <button class="st-button"
                            data-ng-click="remove(alert)">
                        <i class="icon-ok icon-large"></i>
                    </button>
                    <button class="st-button"
                            data-ng-click="confirmDelete = !confirmDelete">
                        <i class="icon-remove icon-large"></i>
                    </button>
                </span>
                <span data-ng-show="isEditing">
                    <button class="st-button"
                            data-ng-click="submit()">
                        <i class="icon-ok icon-large"></i>
                    </button>
                    <button class="st-button"
                            data-ng-click="cancel()">
                        <i class="icon-remove icon-large"></i>
                    </button>
                </span>
            </div>
        </header>

        <section data-ng-class="{'is-expanded' : isEditing}">
            <div class="box filter">

                <header>Filter</header>

                <div class="field">
                    <label for="accountCombo{{ $index }}">Account</label>
                    <select id="accountCombo{{ $index }}"
                            data-ng-options="account.id as account.name for account in accounts"
                            data-ng-model="alert.account_id"></select>
                </div>

                <div class="field">

                    <label>Pivot By</label>
                    <select id="pivotCombo{{ $index }}"
                            data-ng-options="pivot.id as pivot.name for pivot in pivotTypes"
                            data-ng-model="alert.pivot_type_id"
                            data-ng-change="pivotChanged()"></select>
                </div>

                <div class="field">

                    <label for="typeCombo{{ $index }}">Service Provider</label>
                    <select id="typeCombo{{ $index }}"
                            data-ng-model="alert.service_provider_id"
                            data-ng-options="type.id as type.name for type in getPivots()"></select>
                </div>

                <div class="field">

                    <label for="subTypeCombo{{ $index }}">Service Product</label>
                    <select id="subTypeCombo{{ $index }}"
                            data-ng-model="alert.service_provider_product_id"
                            data-ng-options="subType.id as subType.name for subType in getSubPivots()"></select>
                </div>

            </div>
            <div class="box condition">
                <header>Condition</header>

                <div class="field">

                    <label for="timeFrame{{ $index }}">Time Frame</label>
                    <select id="timeFrame{{ $index }}"
                            data-ng-model="alert.alert_time_frame_id"
                            data-ng-options="timeFrame.id as timeFrame.name for timeFrame in timeFrames"></select>
                </div>

                <div class="field">

                    <label for="calculation{{ $index }}">Calculation</label>
                    <select id="calculation{{ $index }}"
                            data-ng-model="alert.alert_calculation_type_id"
                            data-ng-options="calcType.id as calcType.name for calcType in calculationTypes"></select>
                </div>

                <div class="field">

                    <label for="valueType{{ $index }}">Value</label>
                    <select id="valueType{{ $index }}"
                            data-ng-model="alert.alert_value_type_id"
                            data-ng-options="valueType.id as valueType.name for valueType in valueTypes"></select>
                </div>

                <div class="field">

                    <label for="comparison{{ $index }}">Is</label>
                    <select id="comparison{{ $index }}"
                            data-ng-model="alert.alert_comparison_type_id"
                            data-ng-options="compType.id as compType.name for compType in comparisonTypes"></select>
                </div>

                <div class="field">
                    <label for="threshold{{ $index }}">Threshold</label>
                    <input id="threshold{{ $index }}"
                           data-ng-model="alert.threshold"
                           required
                           type="text">
                </div>
            </div>
            <div class="box notification">
                <header>Notification</header>

                <div class="field"
                     data-ng-repeat="displayInType in displayInTypes">

                    <label data-ng-if="$first">Display in my</label>
                    <input type="checkbox"
                           id="displayIn{{ $index }}"
                           data-ng-model="alert.displayIn[displayInType.name]">
                    <label for="displayIn{{ $index }}">{{ displayInType.name }}</label>
                </div>

                <div class="field">

                    <label>Also, please</label>
                    <input type="checkbox"
                           id="emailMe{{ $index }}"
                           data-ng-model="alert.send_email">
                    <label for="emailMe{{ $index }}">email me</label>
                </div>

                <div class="field"
                     data-ng-if="alert.send_email">

                    <label for="email{{ $index }}">at this email:</label>
                    <input id="email{{ $index }}"
                           type="text"
                           data-ng-model="alert.email"
                           placeholder="m.deady410@comcast.net">

                </div>
            </div>
        </section>

    </div>
</div>
