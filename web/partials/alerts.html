<div class="st-alert-wrapper">

    <div class="st-alert"
         data-ng-repeat="alert in alerts"
         data-ng-controller="AlertCtrl">

        <header>
            adsf{{ name + '&nbsp;' }}
            <div class="icons">
                <span data-ng-show="!isDeleting() && !isEditing()">
                    <button class="st-button"
                            data-ng-click="edit()">
                        <i class="icon-pencil icon-large"></i>
                    </button>
                    <button class="st-button"
                            data-ng-click="askToDelete()">
                        <i class="icon-trash icon-large"></i>
                    </button>
                </span>
                <span data-ng-show="isEditing()">
                    <button class="st-button"
                            data-ng-click="submit()">
                        <i class="icon-ok icon-large"></i>
                    </button>
                    <button class="st-button"
                            data-ng-click="cancelEdit()">
                        <i class="icon-remove icon-large"></i>
                    </button>
                </span>
                <span data-ng-show="isDeleting()">
                    <span>
                        Are you sure you want to delete this alert?
                    </span>
                    <button class="st-button"
                            data-ng-click="remove(alert)">
                        <i class="icon-ok icon-large"></i>
                    </button>
                    <button class="st-button"
                            data-ng-click="cancelDelete()">
                        <i class="icon-remove icon-large"></i>
                    </button>
                </span>
            </div>
        </header>

        <section data-ng-class="{'is-expanded' : isExpanded()}">
            <div class="box filter">

                <header>Filter</header>

                <div class="field">
                    <label for="accountCombo{{ $index }}">Account</label>
                    <select id="accountCombo{{ $index }}"
                            data-ng-options="account.id as account.name for account in accounts"
                            data-ng-model="alert.accountId"></select>
                </div>

                <div class="field">

                    <label>Pivot By</label>
                    <select id="pivotCombo{{ $index }}"
                            data-ng-options="pivot.id as pivot.name for pivot in pivotTypes"
                            data-ng-model="alert.pivotTypeId"
                            data-ng-change="pivotChanged()"></select>
                </div>

                <div class="field" data-ng-show="alert.pivotTypeId == 1">

                    <label for="provider{{ $index }}">Service Provider</label>
                    <select id="provider{{ $index }}"
                            data-ng-model="alert.providerId"
                            data-ng-options="provider.id as provider.name for provider in getProviders()"></select>
                </div>

                <div class="field" data-ng-show="alert.pivotTypeId == 1">

                    <label for="product{{ $index }}">Service Product</label>
                    <select id="product{{ $index }}"
                            data-ng-model="alert.productId"
                            data-ng-options="product.subId as product.subName for product in getProducts()"></select>
                </div>

                <div class="field" data-ng-show="alert.pivotTypeId == 2">

                    <label for="serviceType{{ $index }}">Service Type</label>
                    <select id="serviceType{{ $index }}"
                            data-ng-model="alert.serviceTypeId"
                            data-ng-options="type.id as type.name for type in getServiceTypes()"></select>
                </div>

                <div class="field" data-ng-show="alert.pivotTypeId == 2">

                    <label for="serviceTypeCategory{{ $index }}">Service Category</label>
                    <select id="serviceTypeCategory{{ $index }}"
                            data-ng-model="alert.categoryId"
                            data-ng-options="cat.subId as cat.subName for cat in getServiceCategories()"></select>
                </div>

            </div>
            <div class="box condition">
                <header>Condition</header>

                <div class="field">

                    <label for="timeFrame{{ $index }}">Time Frame</label>
                    <select id="timeFrame{{ $index }}"
                            data-ng-model="alert.timeFrameId"
                            data-ng-options="id as name for (id, name) in timeFrames"></select>
                </div>

                <div class="field">

                    <label for="calculation{{ $index }}">Calculation</label>
                    <select id="calculation{{ $index }}"
                            data-ng-model="alert.calculationTypeId"
                            data-ng-options="id as name for (id, name) in calculationTypes"></select>
                </div>

                <div class="field">

                    <label for="valueType{{ $index }}">Value</label>
                    <select id="valueType{{ $index }}"
                            data-ng-model="alert.valueTypeId"
                            data-ng-options="id as name for (id, name) in valueTypes"></select>
                </div>

                <div class="field">

                    <label for="comparison{{ $index }}">Is</label>
                    <select id="comparison{{ $index }}"
                            data-ng-model="alert.comparisonTypeId"
                            data-ng-options="id as name for (id, name) in comparisonTypes"></select>
                </div>

                <div class="field">
                    <label for="threshold{{ $index }}">Threshold</label>
                    <input id="threshold{{ $index }}"
                           data-ng-model="alert.threshold"
                           required
                           type="text">
                </div>
            </div>
            <div class="box notification">
                <header>Notification</header>

                <div class="field">

                    <label>Display in my</label>
                    <input id="breakdown{{ $index }}"
                           data-ng-init="alert.inBreakdown = alert.inBreakdown == 1"
                           data-ng-model="alert.inBreakdown"
                           type="checkbox">
                    <label for="breakdown{{ $index }}">Breakdown</label>
                </div>

                <div class="field">

                    <label>Also, please</label>
                    <input type="checkbox"
                           id="emailMe{{ $index }}"
                           data-ng-init="alert.inEmail = alert.inEmail == 1"
                           data-ng-model="alert.inEmail">
                    <label for="emailMe{{ $index }}">email me</label>
                </div>

                <div class="field"
                     data-ng-if="alert.inEmail">

                    <label for="email{{ $index }}">at this email:</label>
                    <input id="email{{ $index }}"
                           type="text"
                           data-ng-model="alert.email"
                           placeholder="{{ userEmail }}">

                </div>
            </div>
        </section>

    </div>
</div>
